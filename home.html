<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Painel Administrativo</title>

  <style>
    body {
      display: none;
      font-family: Arial, sans-serif;
      background: #f4f6f8;
      margin: 0;
      padding: 20px;
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
    }

    h1 {
      margin: 0;
    }

    button {
      padding: 8px 14px;
      border: none;
      cursor: pointer;
      border-radius: 4px;
      font-weight: bold;
    }

    .btn-logout {
      background: #e74c3c;
      color: #fff;
    }

    .container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }

    .box {
      background: #fff;
      padding: 15px;
      border-radius: 6px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.08);
    }

    .box h2 {
      margin-top: 0;
      border-bottom: 1px solid #ddd;
      padding-bottom: 8px;
    }

    .comentario {
      border: 1px solid #ddd;
      padding: 10px;
      margin-bottom: 10px;
      border-radius: 4px;
    }

    .comentario strong {
      display: block;
    }

    .acoes {
      margin-top: 8px;
    }

    .acoes button {
      margin-right: 6px;
      font-size: 12px;
    }

    .btn-aprovar {
      background: #2ecc71;
      color: #fff;
    }

    .btn-remover {
      background: #f39c12;
      color: #fff;
    }

    .btn-excluir {
      background: #c0392b;
      color: #fff;
    }

    @media (max-width: 900px) {
      .container {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>

<header>
  <h1>Painel de Coment√°rios</h1>
  <button id="btnLogout" class="btn-logout">Sair</button>
</header>

<div class="container">
  <div class="box">
    <h2>Coment√°rios n√£o postados</h2>
    <div id="comentariosPendentes"></div>
  </div>

  <div class="box">
    <h2>Coment√°rios postados</h2>
    <div id="comentariosAprovados"></div>
  </div>
</div>

<!-- Supabase -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>

<script>
  const supabaseUrl = "https://uqhuqyyzygzisohwkyeu.supabase.co";
  const supabaseKey = "sb_publishable_JxPXj6Vyt7z_Jj_SPofMOw_Gsmk3hMW";
  const client = supabase.createClient(supabaseUrl, supabaseKey);

  async function checkUser() {
    const { data } = await client.auth.getUser();
    if (!data.user) {
      window.location.href = "/login/index.html";
    } else {
      document.body.style.display = "block";
      carregarComentarios();
    }
  }

  async function logout() {
    await client.auth.signOut();
    window.location.href = "/login/index.html";
  }

  document.getElementById("btnLogout").addEventListener("click", logout);

  async function carregarComentarios() {
    carregarPendentes();
    carregarAprovados();
  }

  // üî¥ Pendentes (aprovado = false)
  async function carregarPendentes() {
    const { data, error } = await client
      .from("comentarios")
      .select("*")
      .eq("aprovado", false)
      .order("id", { ascending: false });

    if (error) return console.error(error);

    const lista = document.getElementById("comentariosPendentes");
    lista.innerHTML = "";

    data.forEach(c => {
      lista.innerHTML += `
        <div class="comentario">
          <strong>${c.nome} (${c.estrelas}‚òÖ)</strong>
          <p>${c.mensagem}</p>
          <div class="acoes">
            <button class="btn-aprovar" onclick="aprovar(${c.id})">Aprovar</button>
            <button class="btn-excluir" onclick="excluir(${c.id})">Excluir</button>
          </div>
        </div>
      `;
    });
  }

  // üü¢ Aprovados (aprovado = true)
  async function carregarAprovados() {
    const { data, error } = await client
      .from("comentarios")
      .select("*")
      .eq("aprovado", true)
      .order("id", { ascending: false });

    if (error) return console.error(error);

    const lista = document.getElementById("comentariosAprovados");
    lista.innerHTML = "";

    data.forEach(c => {
      lista.innerHTML += `
        <div class="comentario">
          <strong>${c.nome} (${c.estrelas}‚òÖ)</strong>
          <p>${c.mensagem}</p>
          <div class="acoes">
            <button class="btn-remover" onclick="desaprovar(${c.id})">Ocultar</button>
            <button class="btn-excluir" onclick="excluir(${c.id})">Excluir</button>
          </div>
        </div>
      `;
    });
  }

  async function aprovar(id) {
    await client.from("comentarios").update({ aprovado: true }).eq("id", id);
    carregarComentarios();
  }

  async function desaprovar(id) {
    await client.from("comentarios").update({ aprovado: false }).eq("id", id);
    carregarComentarios();
  }

  async function excluir(id) {
    await client.from("comentarios").delete().eq("id", id);
    carregarComentarios();
  }

  checkUser();
</script>


</body>
</html>
